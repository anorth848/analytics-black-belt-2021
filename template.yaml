AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31
Description: >
  #TODO

Parameters:
  DbName:
    Type: String
    Default: hammerdb
    AllowedPattern: "[a-z_]+"
    Description: Glue Data Catalog Database Name. Only lower-case and _ allowed.

Resources:
  DataLakeStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: templates/datalake.yaml
      Parameters:
        DbName: !Ref DbName
        ParentStack: !Ref AWS::StackName

  CicdInfrastructureStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: templates/cicd-infrastructure.yaml
      Parameters:
        ParentStack: !Ref AWS::StackName

  RuntimeInfrastructureStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: templates/runtime-infrastructure.yaml
      Parameters:
        ParentStack: !Ref AWS::StackName

  SecretsStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: templates/secrets.yaml
      Parameters:
        SecretName: !Ref DbName
        ParentStack: !Ref AWS::StackName

  FullPipelineStack:
    Type: AWS::Serverless::Application
    DependsOn: RuntimeInfrastructureStack
    Properties:
      Location: templates/full-pipeline.yaml
      Parameters:
        ParentStack: !Ref AWS::StackName

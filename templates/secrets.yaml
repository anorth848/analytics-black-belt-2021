AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31
Description: >
  Create an empty secret to be referenced by the pipeline. Secret values should be entered manually after creation.

Parameters:
  ParentStack:
    Type: String
    Description: Parent stack this template was launched from, used for naming SSM parameters

  UseCase:
    Type: String
    AllowedPattern: "[a-z_]+"
    Description: The use case. This will be used for naming resources throughout nested stacks.

Resources:
  #  NOTE: These are placeholder secrets and need to be updated to reflect the source database server
  #  Recommended to manually update these secrets to match the correct values and then create the dms-infrastructure stack
  RdbmsSparkSecret:
    Type: AWS::SecretsManager::Secret
    Properties:
      Description: Secret manager secret for Spark user in the primary rdbms
      Name: !Sub '${ParentStack}/rdbms/rds/primary/spark'
      SecretString:  >
        {
          "username": "xxxxxxxxx",
          "password": "xxxxxxxxx",
          "engine": "postgres",
          "host": "xxxxxxxxx",
          "port": 5432,
          "dbname": "xxxxxxxxx"
        }

  RdbmsDmsSecret:
    Type: AWS::SecretsManager::Secret
    Properties:
      Description: Secret manager secret for DMS user in the primary rdbms
      Name: !Sub '${ParentStack}/rdbms/rds/primary/dms'
      SecretString: >
        {
          "username": "xxxxxxxxx",
          "password": "xxxxxxxxx",
          "engine": "postgres",
          "host": "xxxxxxxxx",
          "port": 5432,
          "dbname": "xxxxxxxxx"
        }

  RdbmsSparkSecretArnParameter:
    Type: AWS::SSM::Parameter
    Properties:
      Description: Secret manager secret ARN for Spark
      Name: !Sub '/${ParentStack}/secrets/rdbms/primary/spark/arn'
      Type: String
      Value: !Ref RdbmsSparkSecret

  RdbmsDmsSecretArnParameter:
    Type: AWS::SSM::Parameter
    Properties:
      Description: Secret manager secret ARN for DMS
      Name: !Sub '/${ParentStack}/secrets/rdbms/primary/dms/arn'
      Type: String
      Value: !Ref RdbmsDmsSecret
